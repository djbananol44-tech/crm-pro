<?php

namespace App\Console\Commands;

use Illuminate\Console\Command;
use Illuminate\Support\Facades\Artisan;

class CrmSetupCommand extends Command
{
    /**
     * ÐÐ°Ð·Ð²Ð°Ð½Ð¸Ðµ Ð¸ ÑÐ¸Ð³Ð½Ð°Ñ‚ÑƒÑ€Ð° ÐºÐ¾Ð½ÑÐ¾Ð»ÑŒÐ½Ð¾Ð¹ ÐºÐ¾Ð¼Ð°Ð½Ð´Ñ‹.
     *
     * @var string
     */
    protected $signature = 'crm:setup 
                            {--fresh : ÐŸÐ¾Ð»Ð½Ð°Ñ Ð¿ÐµÑ€ÐµÑÐ¾Ð·Ð´Ð°Ð½Ð¸Ðµ Ð±Ð°Ð·Ñ‹ Ð´Ð°Ð½Ð½Ñ‹Ñ… (migrate:fresh)}
                            {--seed : Ð¢Ð¾Ð»ÑŒÐºÐ¾ Ð·Ð°Ð¿ÑƒÑÐº ÑÐ¸Ð´ÐµÑ€Ð¾Ð² Ð±ÐµÐ· Ð¼Ð¸Ð³Ñ€Ð°Ñ†Ð¸Ð¹}';

    /**
     * ÐžÐ¿Ð¸ÑÐ°Ð½Ð¸Ðµ ÐºÐ¾Ð½ÑÐ¾Ð»ÑŒÐ½Ð¾Ð¹ ÐºÐ¾Ð¼Ð°Ð½Ð´Ñ‹.
     *
     * @var string
     */
    protected $description = 'ÐŸÐµÑ€Ð²Ð¾Ð½Ð°Ñ‡Ð°Ð»ÑŒÐ½Ð°Ñ Ð½Ð°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ° CRM ÑÐ¸ÑÑ‚ÐµÐ¼Ñ‹';

    /**
     * Ð’Ñ‹Ð¿Ð¾Ð»Ð½Ð¸Ñ‚ÑŒ ÐºÐ¾Ð½ÑÐ¾Ð»ÑŒÐ½ÑƒÑŽ ÐºÐ¾Ð¼Ð°Ð½Ð´Ñƒ.
     */
    public function handle(): int
    {
        $this->printBanner();

        // ÐŸÐ¾Ð´Ñ‚Ð²ÐµÑ€Ð¶Ð´ÐµÐ½Ð¸Ðµ Ð´Ð»Ñ fresh
        if ($this->option('fresh')) {
            if (!$this->confirm('âš ï¸  Ð’Ð½Ð¸Ð¼Ð°Ð½Ð¸Ðµ! Ð’ÑÐµ Ð´Ð°Ð½Ð½Ñ‹Ðµ Ð±ÑƒÐ´ÑƒÑ‚ ÑƒÐ´Ð°Ð»ÐµÐ½Ñ‹. ÐŸÑ€Ð¾Ð´Ð¾Ð»Ð¶Ð¸Ñ‚ÑŒ?', false)) {
                $this->info('ÐžÑ‚Ð¼ÐµÐ½ÐµÐ½Ð¾.');

                return self::SUCCESS;
            }
        }

        $this->newLine();

        // Ð—Ð°Ð¿ÑƒÑÐº Ð¼Ð¸Ð³Ñ€Ð°Ñ†Ð¸Ð¹
        if (!$this->option('seed')) {
            $this->info('ðŸ“¦ Ð—Ð°Ð¿ÑƒÑÐº Ð¼Ð¸Ð³Ñ€Ð°Ñ†Ð¸Ð¹...');
            $this->newLine();

            if ($this->option('fresh')) {
                Artisan::call('migrate:fresh', ['--force' => true], $this->output);
            } else {
                Artisan::call('migrate', ['--force' => true], $this->output);
            }

            $this->newLine();
            $this->info('âœ“ ÐœÐ¸Ð³Ñ€Ð°Ñ†Ð¸Ð¸ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ñ‹');
        }

        // Ð—Ð°Ð¿ÑƒÑÐº ÑÐ¸Ð´ÐµÑ€Ð¾Ð²
        $this->newLine();
        $this->info('ðŸŒ± Ð—Ð°Ð¿ÑƒÑÐº ÑÐ¸Ð´ÐµÑ€Ð¾Ð²...');
        $this->newLine();

        Artisan::call('db:seed', ['--force' => true], $this->output);

        $this->newLine();
        $this->info('âœ“ Ð¡Ð¸Ð´ÐµÑ€Ñ‹ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ñ‹');

        // ÐžÑ‡Ð¸ÑÑ‚ÐºÐ° ÐºÑÑˆÐ°
        $this->newLine();
        $this->info('ðŸ§¹ ÐžÑ‡Ð¸ÑÑ‚ÐºÐ° ÐºÑÑˆÐ°...');

        Artisan::call('config:clear');
        Artisan::call('cache:clear');
        Artisan::call('view:clear');

        $this->info('âœ“ ÐšÑÑˆ Ð¾Ñ‡Ð¸Ñ‰ÐµÐ½');

        // Ð’Ñ‹Ð²Ð¾Ð´ Ð¸Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸Ð¸ Ð´Ð»Ñ Ð²Ñ…Ð¾Ð´Ð°
        $this->printCredentials();

        return self::SUCCESS;
    }

    /**
     * Ð’Ñ‹Ð²ÐµÑÑ‚Ð¸ Ð±Ð°Ð½Ð½ÐµÑ€.
     */
    protected function printBanner(): void
    {
        $this->newLine();
        $this->line('â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—');
        $this->line('â•‘                                                              â•‘');
        $this->line('â•‘     ðŸš€  CRM Ð¡Ð˜Ð¡Ð¢Ð•ÐœÐ â€” ÐŸÐ•Ð Ð’ÐžÐÐÐ§ÐÐ›Ð¬ÐÐÐ¯ ÐÐÐ¡Ð¢Ð ÐžÐ™ÐšÐ             â•‘');
        $this->line('â•‘                                                              â•‘');
        $this->line('â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');
    }

    /**
     * Ð’Ñ‹Ð²ÐµÑÑ‚Ð¸ Ð´Ð°Ð½Ð½Ñ‹Ðµ Ð´Ð»Ñ Ð²Ñ…Ð¾Ð´Ð°.
     */
    protected function printCredentials(): void
    {
        $this->newLine(2);
        $this->line('â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—');
        $this->line('â•‘                  Ð”ÐÐÐÐ«Ð• Ð”Ð›Ð¯ Ð’Ð¥ÐžÐ”Ð Ð’ Ð¡Ð˜Ð¡Ð¢Ð•ÐœÐ£                 â•‘');
        $this->line('â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£');
        $this->line('â•‘                                                              â•‘');
        $this->line('â•‘  ðŸ‘¤ ÐÐ”ÐœÐ˜ÐÐ˜Ð¡Ð¢Ð ÐÐ¢ÐžÐ                                            â•‘');
        $this->line('â•‘     Email:    admin@crm.test                                â•‘');
        $this->line('â•‘     ÐŸÐ°Ñ€Ð¾Ð»ÑŒ:   admin123                                      â•‘');
        $this->line('â•‘     Ð’Ñ…Ð¾Ð´:     /admin                                        â•‘');
        $this->line('â•‘                                                              â•‘');
        $this->line('â•‘  ðŸ‘¤ ÐœÐ•ÐÐ•Ð”Ð–Ð•Ð                                                  â•‘');
        $this->line('â•‘     Email:    manager@crm.test                              â•‘');
        $this->line('â•‘     ÐŸÐ°Ñ€Ð¾Ð»ÑŒ:   manager123                                    â•‘');
        $this->line('â•‘     Ð’Ñ…Ð¾Ð´:     /login                                        â•‘');
        $this->line('â•‘                                                              â•‘');
        $this->line('â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£');
        $this->line('â•‘                                                              â•‘');
        $this->line('â•‘  ðŸ“Œ URL-Ð°Ð´Ñ€ÐµÑÐ°:                                              â•‘');
        $this->line('â•‘     â€¢ ÐÐ´Ð¼Ð¸Ð½-Ð¿Ð°Ð½ÐµÐ»ÑŒ:  /admin                                 â•‘');
        $this->line('â•‘     â€¢ Ð”Ð°ÑˆÐ±Ð¾Ñ€Ð´:       /deals                                 â•‘');
        $this->line('â•‘     â€¢ ÐÐ²Ñ‚Ð¾Ñ€Ð¸Ð·Ð°Ñ†Ð¸Ñ:   /login                                 â•‘');
        $this->line('â•‘                                                              â•‘');
        $this->line('â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');
        $this->newLine();

        $this->warn('âš ï¸  ÐÐµ Ð·Ð°Ð±ÑƒÐ´ÑŒÑ‚Ðµ Ð¸Ð·Ð¼ÐµÐ½Ð¸Ñ‚ÑŒ Ð¿Ð°Ñ€Ð¾Ð»Ð¸ Ð² Ð¿Ñ€Ð¾Ð´Ð°ÐºÑˆÐ½-ÑÑ€ÐµÐ´Ðµ!');
        $this->newLine();
    }
}
